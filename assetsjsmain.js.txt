// Configuration
const NEWS_API_KEY = 'YOUR_NEWS_API_KEY'; // Get one at newsapi.org
const AI_DOMAINS = 'openai.com,techcrunch.com,wired.com,technologyreview.com,aimagazine.com,venturebeat.com,analyticsvidhya.com,marktechpost.com,artificialintelligence-news.com,emerj.com';

async function fetchLiveAINews() {
    const newsGrid = document.getElementById('news-grid');
    const contentGate = document.getElementById('content-gate');
    const isLoggedIn = localStorage.getItem('userToken');

    if (!isLoggedIn) {
        contentGate.style.display = 'block';
        newsGrid.style.display = 'none';
        return;
    }

    try {
        const response = await fetch(`https://newsapi.org/v2/everything?domains=${AI_DOMAINS}&q=artificial+intelligence&sortBy=publishedAt&apiKey=${NEWS_API_KEY}`);
        const data = await response.json();

        if (data.status === 'ok') {
            renderNews(data.articles);
            updateLastUpdatedTime();
        }
    } catch (error) {
        console.error('Error fetching news:', error);
        newsGrid.innerHTML = '<p class="error">Failed to load live feed. Please try again later.</p>';
    }
}

function renderNews(articles) {
    const newsGrid = document.getElementById('news-grid');
    newsGrid.style.display = 'grid';
    
    newsGrid.innerHTML = articles.slice(0, 12).map(article => `
        <div class="news-item" onclick="window.open('${article.url}', '_blank')">
            <div class="news-meta">
                <span class="news-source">${article.source.name}</span>
                <span class="news-time">${new Date(article.publishedAt).toLocaleTimeString()}</span>
            </div>
            <h3 class="news-title">${article.title}</h3>
            <p class="news-summary">${article.description || 'Click to read the full story...'}</p>
            <div class="news-tags">
                <span class="tag">Live Update</span>
                <span class="tag">AI</span>
            </div>
        </div>
    `).join('');
}

// 2. Set the 1-hour Refresh Timer
// 1 hour = 60 mins * 60 secs * 1000 ms = 3,600,000ms
setInterval(fetchLiveAINews, 3600000);

// Initial load
document.addEventListener('DOMContentLoaded', fetchLiveAINews);
